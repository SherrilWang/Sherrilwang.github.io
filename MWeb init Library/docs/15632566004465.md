# %filtering
general.fmin = 0.5; %Hz 0.2;%
general.fmax = 75;%5; %Hz
general.attenuation = 20;%10;%dB
general.order = 3; %4 did not work
[b, a] = cheby2(general.order,general.attenuation,general.fmin*2/150,'high');%Riedner 2007
% [b, a] = cheby2(general.order,general.attenuation,[general.fmin*2/150,general.fmax*2/150]);%Riedner 2007

arraysize=size(ratioSequence);
array = zeros(arraysize(1),arraysize(2),arraysize(3));
disp('temporal filtering...');
cacha=[];
mcache=[];

for y = 1:arraysize(1)
    for x = 1:arraysize(2)
        if mask(y,x)==1
            cache =  filtfilt(b,a,double(ratioSequence(y,x,:)));
            mcache = mean(cache);
            array(y,x,:) = cache - mcache;
        end
    end
end

arraysize=size(array);
ave_array=reshape(array,[arraysize(1)*arraysize(2),arraysize(3)]);
ave_array=mean(ave_array);

plot(ave_array)


arraystd=std(arrayaveall,1,'all')
arrayaveall(find(abs(arrayaveall)>3*arraystd))=0;
